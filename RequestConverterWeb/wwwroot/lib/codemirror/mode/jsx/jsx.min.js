!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../xml/xml"),require("../javascript/javascript")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../xml/xml","../javascript/javascript"],t):t(CodeMirror)}(function(u){"use strict";function x(t,e,n,r){this.state=t,this.mode=e,this.depth=n,this.prev=r}u.defineMode("jsx",function(o,t){var s=u.getMode(o,{name:"xml",allowMissing:!0,multilineTagIndentPastTag:!1,allowMissingTagName:!0}),c=u.getMode(o,t&&t.base||"javascript");function p(t){var e=t.tagName,n=(t.tagName=null,s.indent(t,"",""));return t.tagName=e,n}function d(t,e){return(e.context.mode==s?function(t,e,n){if(2==n.depth)return t.match(/^.*?\*\//)?n.depth=1:t.skipToEnd(),"comment";if("{"==t.peek()){s.skipAttribute(n.state);var r=p(n.state),i=n.state.context;if(i&&t.match(/^[^>]*>\s*$/,!1)){for(;i.prev&&!i.startOfLine;)i=i.prev;i.startOfLine?r-=o.indentUnit:n.prev.state.lexical&&(r=n.prev.state.lexical.indented)}else 1==n.depth&&(r+=o.indentUnit);return e.context=new x(u.startState(c,r),c,0,e.context),null}if(1==n.depth){if("<"==t.peek())return s.skipAttribute(n.state),e.context=new x(u.startState(s,p(n.state)),s,0,e.context),null;if(t.match("//"))return t.skipToEnd(),"comment";if(t.match("/*"))return n.depth=2,d(t,e)}var r=s.token(t,n.state),a=t.current();/\btag\b/.test(r)?/>$/.test(a)?n.state.context?n.depth=0:e.context=e.context.prev:/^</.test(a)&&(n.depth=1):!r&&-1<(e=a.indexOf("{"))&&t.backUp(a.length-e);return r}:function(t,e,n){if("<"==t.peek()&&c.expressionAllowed(t,n.state))return e.context=new x(u.startState(s,c.indent(n.state,"","")),s,0,e.context),c.skipExpression(n.state),null;var r=c.token(t,n.state);r||null==n.depth||("{"==(t=t.current())?n.depth++:"}"==t&&0==--n.depth&&(e.context=e.context.prev));return r})(t,e,e.context)}return{startState:function(){return{context:new x(u.startState(c),c)}},copyState:function(t){return{context:function t(e){return new x(u.copyState(e.mode,e.state),e.mode,e.depth,e.prev&&t(e.prev))}(t.context)}},token:d,indent:function(t,e,n){return t.context.mode.indent(t.context.state,e,n)},innerMode:function(t){return t.context}}},"xml","javascript"),u.defineMIME("text/jsx","jsx"),u.defineMIME("text/typescript-jsx",{name:"jsx",base:{name:"javascript",typescript:!0}})});