!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("velocity",function(){function e(e){for(var t={},n=e.split(" "),r=0;r<n.length;++r)t[n[r]]=!0;return t}var a=e("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}"),i=e("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}"),o=e("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent.count $foreach.parent.hasNext $foreach.parent.first $foreach.parent.last $foreach.parent $velocityCount $!bodyContent $bodyContent"),s=/[+\-*&%=<>!?:\/|]/;function l(e,t,n){return(t.tokenize=n)(e,t)}function u(e,t){var n=t.beforeParams,r=(t.beforeParams=!1,e.next());return"'"==r&&!t.inString&&t.inParams?(t.lastTokenWasBuiltin=!1,l(e,t,f(r))):'"'==r?(t.lastTokenWasBuiltin=!1,t.inString?(t.inString=!1,"string"):t.inParams?l(e,t,f(r)):void 0):/[\[\]{}\(\),;\.]/.test(r)?("("==r&&n?t.inParams=!0:")"==r&&(t.inParams=!1,t.lastTokenWasBuiltin=!0),null):/\d/.test(r)?(t.lastTokenWasBuiltin=!1,e.eatWhile(/[\w\.]/),"number"):"#"==r&&e.eat("*")?(t.lastTokenWasBuiltin=!1,l(e,t,c)):"#"==r&&e.match(/ *\[ *\[/)?(t.lastTokenWasBuiltin=!1,l(e,t,k)):"#"==r&&e.eat("#")?(t.lastTokenWasBuiltin=!1,e.skipToEnd(),"comment"):"$"==r?(e.eat("!"),e.eatWhile(/[\w\d\$_\.{}-]/),o&&o.propertyIsEnumerable(e.current())?"keyword":(t.lastTokenWasBuiltin=!0,t.beforeParams=!0,"builtin")):s.test(r)?(t.lastTokenWasBuiltin=!1,e.eatWhile(s),"operator"):(e.eatWhile(/[\w\$_{}@]/),n=e.current(),a&&a.propertyIsEnumerable(n)?"keyword":i&&i.propertyIsEnumerable(n)||e.current().match(/^#@?[a-z0-9_]+ *$/i)&&"("==e.peek()&&(!i||!i.propertyIsEnumerable(n.toLowerCase()))?(t.beforeParams=!0,t.lastTokenWasBuiltin=!1,"keyword"):t.inString?(t.lastTokenWasBuiltin=!1,"string"):e.pos>n.length&&"."==e.string.charAt(e.pos-n.length-1)&&t.lastTokenWasBuiltin?"builtin":(t.lastTokenWasBuiltin=!1,null))}function f(i){return function(e,t){for(var n,r=!1,a=!1;null!=(n=e.next());){if(n==i&&!r){a=!0;break}if('"'==i&&"$"==e.peek()&&!r){a=t.inString=!0;break}r=!r&&"\\"==n}return a&&(t.tokenize=u),"string"}}function c(e,t){for(var n,r=!1;n=e.next();){if("#"==n&&r){t.tokenize=u;break}r="*"==n}return"comment"}function k(e,t){for(var n,r=0;n=e.next();){if("#"==n&&2==r){t.tokenize=u;break}"]"==n?r++:" "!=n&&(r=0)}return"meta"}return{startState:function(){return{tokenize:u,beforeParams:!1,inParams:!1,inString:!1,lastTokenWasBuiltin:!1}},token:function(e,t){return e.eatSpace()?null:t.tokenize(e,t)},blockCommentStart:"#*",blockCommentEnd:"*#",lineComment:"##",fold:"velocity"}}),e.defineMIME("text/velocity","velocity")});