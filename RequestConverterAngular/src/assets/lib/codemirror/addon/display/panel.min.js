!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function h(e,t,i,n){this.cm=e,this.node=t,this.options=i,this.height=n,this.cleared=!1}function c(e,t){for(var i=t.nextSibling;i;i=i.nextSibling)if(i==e.getWrapperElement())return 1}e.defineExtension("addPanel",function(e,t){if(t=t||{},!this.state.panels){var n=this,i=n.getWrapperElement(),r=window.getComputedStyle?window.getComputedStyle(i):i.currentStyle,o=parseInt(r.height),s=n.state.panels={setHeight:i.style.height,panels:[],wrapper:document.createElement("div")},r=n.hasFocus(),l=n.getScrollInfo();i.parentNode.insertBefore(s.wrapper,i),s.wrapper.appendChild(i),n.scrollTo(l.left,l.top),r&&n.focus(),n._setSize=n.setSize,null!=o&&(n.setSize=function(e,t){t=t||s.wrapper.offsetHeight;var i=(t="number"!=typeof(s.setHeight=t)?(i=/^(\d+\.?\d*)px$/.exec(t))?Number(i[1]):(s.wrapper.style.height=t,s.wrapper.offsetHeight):t)-s.panels.map(function(e){return e.node.getBoundingClientRect().height}).reduce(function(e,t){return e+t},0);n._setSize(e,i),o=t})}var i=this.state.panels,l=i.wrapper,r=this.getWrapperElement(),p=t.replace instanceof h&&!t.replace.cleared,p=(t.after instanceof h&&!t.after.cleared?l.insertBefore(e,t.before.node.nextSibling):t.before instanceof h&&!t.before.cleared?l.insertBefore(e,t.before.node):p?(l.insertBefore(e,t.replace.node),t.replace.clear(!0)):"bottom"==t.position?l.appendChild(e):"before-bottom"==t.position?l.insertBefore(e,r.nextSibling):"after-top"==t.position?l.insertBefore(e,r):l.insertBefore(e,l.firstChild),t&&t.height||e.offsetHeight),a=new h(this,e,t,p);return i.panels.push(a),this.setSize(),t.stable&&c(this,e)&&this.scrollTo(null,this.getScrollInfo().top+p),a}),h.prototype.clear=function(e){if(!this.cleared){this.cleared=!0;var t=this.cm.state.panels;if(t.panels.splice(t.panels.indexOf(this),1),this.cm.setSize(),this.options.stable&&c(this.cm,this.node)&&this.cm.scrollTo(null,this.cm.getScrollInfo().top-this.height),t.wrapper.removeChild(this.node),0==t.panels.length&&!e){var t=this.cm,e=t.state.panels,i=(t.state.panels=null,t.getWrapperElement()),n=t.hasFocus(),r=t.getScrollInfo();e.wrapper.parentNode.replaceChild(i,e.wrapper),t.scrollTo(r.left,r.top),n&&t.focus(),i.style.height=e.setHeight,t.setSize=t._setSize,t.setSize()}}},h.prototype.changed=function(){this.height=this.node.getBoundingClientRect().height,this.cm.setSize()}});