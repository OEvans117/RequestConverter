!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(n){"use strict";function i(l){l.state.markedSelection&&l.operation(function(){var e=l;if(e.somethingSelected())if(1<e.listSelections().length)a(e);else{var t=e.getCursor("start"),o=e.getCursor("end"),n=e.state.markedSelection;if(n.length){var i=n[0].find(),r=n[n.length-1].find();if(!i||!r||o.line-t.line<=d||0<=u(t,r.to)||u(o,i.from)<=0)a(e);else{for(;0<u(t,i.from);)n.shift().clear(),i=n[0].find();for(u(t,i.from)<0&&(i.to.line-t.line<d?(n.shift().clear(),f(e,t,i.to,0)):f(e,t,i.from,0));u(o,r.to)<0;)n.pop().clear(),r=n[n.length-1].find();0<u(o,r.to)&&(o.line-r.from.line<d?(n.pop().clear(),f(e,r.from,o)):f(e,r.to,o))}}else f(e,t,o)}else c(e)})}function r(e){e.state.markedSelection&&e.state.markedSelection.length&&e.operation(function(){c(e)})}n.defineOption("styleSelectedText",!1,function(e,t,o){o=o&&o!=n.Init;t&&!o?(e.state.markedSelection=[],e.state.markedSelectionStyle="string"==typeof t?t:"CodeMirror-selectedtext",a(e),e.on("cursorActivity",i),e.on("change",r)):!t&&o&&(e.off("cursorActivity",i),e.off("change",r),c(e),e.state.markedSelection=e.state.markedSelectionStyle=null)});var d=8,m=n.Pos,u=n.cmpPos;function f(e,t,o,n){if(0!=u(t,o))for(var i=e.state.markedSelection,r=e.state.markedSelectionStyle,l=t.line;;){var f=l==t.line?t:m(l,0),c=l+d,a=c>=o.line,s=a?o:m(c,0),f=e.markText(f,s,{className:r});if(null==n?i.push(f):i.splice(n++,0,f),a)break;l=c}}function c(e){for(var t=e.state.markedSelection,o=0;o<t.length;++o)t[o].clear();t.length=0}function a(e){c(e);for(var t=e.listSelections(),o=0;o<t.length;o++)f(e,t[o].from(),t[o].to())}});